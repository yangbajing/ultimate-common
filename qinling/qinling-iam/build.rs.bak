use std::{env, path::PathBuf};

fn main() -> core::result::Result<(), Box<dyn std::error::Error>> {
    let original_out_dir = PathBuf::from(env::var("OUT_DIR")?);

    tonic_build::configure()
        .protoc_arg("--experimental_allow_proto3_optional") // for older systems
        .file_descriptor_set_path(original_out_dir.join("qinling_iam.bin"))
        .compile(
            &[
                "proto/qinling/qinling_iam-auth.proto",
                "proto/qinling/qinling_iam-user.proto",
            ],
            &["proto/qinling"],
        )?;
    Ok(())
}
